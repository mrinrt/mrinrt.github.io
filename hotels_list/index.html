<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"c254d3247c86b9bdded9590b4e34623d92d7d415ebb7ef5ccf5d39067877b90de201a238b585b22a849af4dc43ce9efdc84d90a18b30f4cb776e24f9dfdc64b85ccfdc7d98506ab90eb5e2406029b177c24b1f3f57762a9e7a8854b3eecc8e59db720a1941697c884c8b1084c5d5039eb79f268547818f488a62fa6914d9844dd35c96799b3109135f2de4d93efe2b03846c4ca8d3ce8b601a9f3ad388ed2a5c647bdbe819be06c006445df5a669df945412a234bd894c019a8eff2690bd49ada102bd326408423f58d24a554eb3db651d01d17d70dd63d98bdce0f88bb210beadbca23fd217417732ae57065dbd94f21a7cedee3d29ab582aa8ea7137f5e9205370349b213012bfbcf0edc25c5aad820aef9571d1e0462b55def9a52abebbdc60325ec642c2be43e96465a868a7a2080bf38c15c04e10753a483ed87fa9cb694ac220256688d7448ef8cfe25163a3c8be38fc059b5c77449d6ca900d607ff5b526e541e7f942e03ed48b030f3abe229c7623c54fe6f4e54232f50867405ae20d334d0b5ad66ed18ac85073dbde47cad237de77bc57db14bad6b27a48f7200bd4edcb0f0e7f28bc4d3e06ff294cc274dad2893197598e7cdc449eb8c74eea16e28c9bb644a21dbb49d27f3549caacea8bfba917671fe9144acc74d3c4f08c8b3e3fbb72b7209faa5ae205896f2f59f652cf7d42a11895027b1ed439e90b142eff714d99c82f6186b884af88552486d48ec9ee27b0e681aa97c9bd1bd7633cdc14951bb6882349a2e22c101e2470b21554e176048fd5d5caf5919617b3bc71eaa396ed5e770b4128227e3da04e1d709646871b99702ce5d35a387f77c5a7d65c9f358c033e4bfb3a8404568d187906b6c0344e2941668f1025714cafc3d756dc72cfb5bf800af4372b38e54b94f6b6d230c75fcfce9f3497fc35f195ecd64ae9b48e17d829045f0460248d988103f5b83b044a8e9a2c7caee162ee016ecc4932e78ff961f64ecf4b7a1898aa81adb9644e9c95455eccbcb37dfdaaa83301a54b77655cfae42050581ec8c514c1fdc8aa0c0921f1399e268e5de297a5f13f5e5bf1e9aa837a70a7b345b3133c3e9253f26c846e03e8b07591fa179fd73920dde157dfe56d763358fffd6b3005becb60725fda792df7542f166d2a8e6ff43600c47cbde1d9e9af108755e59b00beb104848c0686d35eef51833554a3114f8f17239e30ccf90e43733ac96b26f2d54a3e9cddf500dfd35658bc66cfbac59dfe56cfdb5de28ded14adf14a1b2a6ddb8654256f4bca396b349d54ff3d526e9730fb1e44715afa47cb4a5fbbca784d780c15160c1a650846dbb558600cb73c04af4ef35ba8b49d57ff9850d5531d9f75cbfc8979746f4de55816842518d00fef07b873fcbf53fe0fadad34dd75940671684564507be3f5840cb250ffae3aad9ce517e01dbd95835ca6efe3725e4bd30e32ac5dc34a29ea8674ff7affaa8b6a607024ef7b4add917f39abfa5e81537ae556c132409b879a10de167bef8e0225970a9940af1c3cea41d48df04c6b1013a00f7ef409a8194f935eb2c5001dbe4a27271b3cd8f51ccb75d6025ac8cdaa7c2bda0fd534ed3657de631f4f49fa34ad28ca98cb4616c0d45bb5bf9cb84e038f6eb63d510d51bf87de1a050c59aa0249b0d403e9574c822497dd8ef5924380b3953eaff3aa741c4b0a16340cb3b0d9615409f9c6b9fc9699f1d512f1ad40fa2a2a8a9563a636b0e1deefb034bf803f127c15cb2fd3abfdf82e0c7d2797d56c8e7b5675af3e9f5a6a2f5d499ecdedc474a5dd81787050436b4c731e74d7522e091113b3332ce783be1913676100d417355300d8c11d88571e700e8a5530492df79343ff161ca802389622e6018453161bbda5cb8548016bf08ff05f5784fae2c6e804ef37727bc394c897d3533a1df96aab341b773ab789b26670e75d2c299e5eede5bbb7e05eb5c360c1237deb943a463bad0290ad7f8a9ab4b99ab13786a1481b1f5822aa1159df7dbe8ee5298c8725ed9c01f818f575ed7fe8c4c4d15b8f1adcc757fb85dcade9adb484b1fce4a85c78547fece51b8235ddbbbccba52d60fe12d1491ff7b96dd4ffbf4d1867ed29506e33480d3f960672793b4631e065c01f5e58d9095ae016778e46449863ed2be6ddddb8fdaebd6eab70fa74d72ccb1fb9744c679f664f4c7ec1a07339c769d7226dda80138b5bd3bb84674e193393af5286d7d4225483120e81a06647791507e1c43c7a91e68adaff2af23c966fb8faaf1c6e4e9a8ab12b352173985bd0fe65a752161aef005f70cdbd1e56520fabdce0420590dfbdf894eab439f553c7ef03d13ea5e8d53921fc571d05dde149241eedb4bce65c08857b1b92771e721c8dbb10fff3969b9d5c580bf76708a2c333a2e4797396433502c64866b5de5c5c7d54ef15c8903d2c9370a30cf70cdd2dc8ac240950db6a9d1a0034cf7e8a81d7587915820070c4ae7d6863a742e8bf7571f33c0fb8f4672193a82dd07b99e9ef7e5806a91669a13e496c21706294a2787be7bef22e6cfd90da22c0184c9d185e7e084f1b5e43bf1cc4bd559e1439421a9ae1b1be67ea9e4ca396b1cd2f6451b43d6568210b577d0194e83fb20f352ec17459fe906c971579f50e8b619493d4a74bb6bc21d1c1785b2e022871571cb7dd083f114842657a58a88f1be678cdd24e8a98d4c3788b50719cd93d1ce2bd3ea12df3f005a0f950e60aba6918644bcf644d83a50b48eed9ab175ba37d1cfd7999f44467b7a25b724343e586bd642930a5785bbd0c9758bd643742ca0cb7a9b0c1538387004d53cf5be706aeb3fd6f4be3831b44908f1538e6ef4db6401d77e2df97b8343be15695a6cdd4af58eef1c0f73e1f064ab4b14f2a314afc87382339cd6a82a4fa029d08d366f17ed07427a88ea3f6aedd77685199b1144082cc0057aeadc201ec45f58d751bab2cc95ad8f75fad36e5e8b0f3455ac2704f17726f93bcdd7d685effc71dcdeb3c1421201506e1d0ae7f5860847a1343a93bc2a758d65d75ca97c6f3f7ceee19bad12c3217e65001fa5a1af2642dd2dcf00b208d46cb8b06c89ced944df303595fc69aac71988a77b24a4d8e82b4dbf8e311c1c7578d404a6d97e5c4e572af35b5d26792b9bd32e6c67e53573072731482951e5b25fc877e5021b2a0be10c9b446add90fe4a1ea963a2367e2c248aaf38507937994536f1ef56a59a737ba24e86589f2734b034f27d5a4ee31ba794e3e99833a5c6486a43c959ee1aeff693ff9d1eaecd7f5add55271ec344b3af098123942c6230a78404e9fa3085860eb0272ad3bd018d01a01f0923d62e0cc5b6de9e9278d97d6e8976f7e4ce583e7b9404ff8d13649dc44833629ef16e01e3be4ac457713cf74aa9062aa028768eb28f6e30fca4e8672e643da470b9f64cde3f382320c08f0ad97bed90b5adf0b39bd5a9a2dcc4514f1d84bc5f30988bc0bf47e7a5a0cf68e053eb7f2750f563ed2d05337ed392c6702f0b233c31ff8e44f4729df19f070956a6e5eaa831a9c8093788395e32d47ac97bbbf27e83b4350b6d2f9117c5639f12f0d2aff63b09f6b2f3ff58ebbeb1750fb81499ba2ba741511677d2fc2c191106bf4baea585c1e956ebf55eb5a36032a16828135086fd33fc4742f9bee7f070dc8696bf75d4c05ad42599dcdbdd42be91e6bd8fea72f4f6960fd603c00136332b7e5566eb97a94298565c8aec4f25b19e144f0597be39329aa37a44584b009d55805cecc4f2cdcafefbd515ded75bf6c9d17fa3b1af74112deb35b0ff7c7d0522501570fd63d57fa3f483489e7b29c69d8cf159f0f4139167b468298d88538a176ea6da224dc08a106cad9a363a1b7daedddd2f06f96486711558f035d4ca4d0c215e3cd919a29f569515fcbec85e277fe1d59e3fed1c521e3697b7e563040c6f3edfad7177d3fe2635b00ac98df6e2f0dd2912336a3bcc366c19b425aa82064d9d42cf5b8467b147488b901ab495764a19842ca90d30d605185da88f8b4156e43d73ebf9d2f62dcf6a8ccf17cf4bfd6958739c55340f72201d84d91a45be417677b2e291128f36c235f0c613874e13575000dd4210fd745aacb2fdf45423b019d94eceb33a016ece87cd6af6277554d9affa977a7aac74d2fd9c08535db1ada06d250cc701ec2b16618183b2f74a4c05f7cc532ca9d032fe250857746d7f5c3a3c282d228af3c0074ffd8facc6d7c5e6bab9ccb369af6efa2ce05d2a18f03da86b484c8c8cd74a4a5406aa589d9b4e3e3a3174254518a7f4d18644ad32bef12e63b4b8b81bcc1d1df074aeedcaa1313c6fc8632582f0270e959305066f6b2c2efa40d6c7d1b1e1eddb54285d98b630b7d8784e5c24203fffb76b4cc80e49dfb8c765aa5368a5f292971b0827e7c35c1b992d2dc771fac5cb7472cf91ffba28353aab2a45eac029520c2219247328c7c8a79703dcb220057a5d8e92cd90f596b9e53f7c21ddf2c893b16b2eeac3749ff396d68ff39b1cacee3ad8718a289327c280fc8f0939e517e41019bd4a865f437e46d8362cbd1367b71bba4b43015a4bdfa076e584afadeb1cd2804ed0c9dafe08d4b05dd0c80493ac57a670a7060325d17fb38be3dd236d57b4aa10af12806f3a814553ec3997a8c25d0a89cd7e19ed59152af24d15f5a66a05e217dbe31b05cec2de8a2fb5b9cfd0a080e090260bdfd90fe3275e524e4ba2a6fe6c853a2e94bd15d35c7aeaa530c56573d829255e16c91b8149f7d678ce01871e0c9c88512bdc8391e6c3edb036877473260f82d517a363e6250423142da717908f9aa115e2920f02b739337d5135b6d81129acf30bf9d7cf99ca1486860656958dd7d451ca03a4139ecc0951b9264f6d86c2dcebd2ef2ee65baff2a9736cc2a3b8cbfd46960831e93ee047fcd9c4d2cf7538f43e27e51e0e339b005f267744f0694fba55977641f0ee1215cb0d8b9d64ccd4c4fb3d69a9a26219abfdd2e208b60c3772056e908074f9f4a4b179f9b70829820eb2b0731ffe3085bb0b0893677bab02f1cda89e68d7e3a5712f37178af37d1ae44429520ada465593ed515e141d39b72f0a4502aba1b20606477e9705359727209df9b5cd46bac5616afcea7e79278a35e74093c8ec89c4ccf31c5aea3457021ee6bdea4f4f2dbd90f5f4ee8796b5c638e9e7c1a1fb0a34d2453086bf073505a7bbc856b17032f48769f0d63252da0c3350e5cc62f16be56e482740d814ed3b5c709c8f8bd36f6d2d3210d11d886ef4d9d7518933441aeb3c4b33b4f5f2217fbc97b60a91705715f1b8acadf73a1b9db177fe60cc5af25d9bb5787417c223d494554297262b5f621c2780316b9618ac1243b37b00a8e2f406ff54fd0b025a7b19d98b22f7f91a82a6fbd88946d2cba7e0477c80acdb4ccff76a524f1dc75ad7814bf9620adf68670c7d406a24bab7b84c8eae4c4ab92d37b7e4bc8698a73e914d61bc9898784c0a4992985cd7141548eb0519d6c70098371fedf4248d02202ccac5423ff2102f79b5b7cbfc92d5ce46481a5b598213b419a02792828924404c3c74ce1b18d68ec47f17d76765eb0460e99e3576d0b07f96726a126c81df491f9032809011b3a02a209c108933246fa33c3e64e3350be1f6953294f057ac6d4f1e5483e90b020703c48061e82802e183bb222b1788d0fcad54ac0f57ecffdd115bff3a9c34915a5165fe103ccc7620eff66a44f13918e37b13cc3f980355c6ccce347393cb0d03816bf60e801eb3fcdbf45a373dbe99200286ea4f0a464a7bca4320e9b9a8c414b3816eae818ce49d6618f2ef6fded98a8b2ee81fa89eab1e0540145e3977c0f26cd90c2f877bebc4957278ff96c519aac546f82f868fabfec65d28622b4dec1ffb3f4774afb838b8f153d1b2e7ad0bec182648940d02be5edb21cbd8c81a94b6182a5550553262e2f9082423f86581c642877225bae7ecfd34b6f2419e7888b85b7b170dfabab3375d7f08b6a4c0fc868a735c2edc81b7155b60516e7adb1e4096a6d6c22d7510706a5bd5782077d29cd7073ff7606cfacbffd60de034645ac02959ee3ccd854e511ae599a1e23ca638046b55f3ad136edfd7afe8155812b39c720ed91f77125a7105f4a12c1f6f31900ef823dce9060b4ae2f222f9c45a1244bc23cafbe4f61d97349197f1e71e8b652ed6dbc307ecb42226251f3444835c4f67d70516b5e7663189c4b940b029d044c332906c498066c0b65e5d794032947fb1de669f18757831e07ce5d81e44abac618757790f3079b3f4b8e0ce774201a887599313d7957e169f03a5d7f72a8e4ee77d6a79b0fad74ce290a99dd94610dd3df5203a591db682493801b11b3d83d30fc4c8a17b25d8800d2f9e745e054afb195a1788b01ba5bda023434b40a0fd4fc09a0d20d3bd99c09872fb56bdcb10e8349eb00e7e4e42ad1ba2ce357ae9a88043ea4f7b13d9ac14e653bf3fac4298385bbbbb6d2e1d657ccbcc023057098560cbf891ff4e08febccd5cfb13915b6a3a1399aa4af033a075fb8ace28f320ae30703fe74c6d3f1e80d8e5f8b78995b077b254cb33c252ad5ca432817bed488b76c53c8e2291409b60527c8512e81f9f52c22a9f6ff98f073bd483904446b5723f8832e1668669cfd85f52de36d57a802220e61058d7c7528cf5c8faad17d6479c4ad62b01f1790fafcc4c377be8f7bbc9b5c5758d8b5fb394a9278cab93cf77737b72a2186348991db2f58f6003966e73d526c0ff83cf3e20a91ccc4ad14b84036c7d88d422366a9070fa4de626d31c36129e2c9abed207a815a520edb25333e5958ddea8544f8b898123bac70b11cf4f791d149ca18ae4429557a4ec40a2e96f0bb5a332962e38bd02480a3e793e2eb0072b8f5f0cdc86150744ed3d79e31602b574c5370d05b1c1cdeae65ff31d22fd076976992e02bb641632d8877f0387c6860cacc55f273b71b28c7c0cc7dc3fdb3a85487459fb42b44c998c499b047f040ee10bce8a3994b8d2cad0d74400d5ae26333f045e6dd6925d708df9e4b5c48caee794972b000f0866b94081da391d3e6a9be9de3e8821f67a221cca38bf08f837a96e235737b5114a7b6815fcff8cb5c5f6d4cf4d13022e4f44ea44a8c84701170d81323089473a794c3879d9ed6076be7dcf2656b50d33a52f1e7ecbf69b8ee09fd1557d6709551e087955ac6967ac835986d4c70033a370bd70da0701459d70e28cea2f470a9616c18b1004e6eb31ff888ec6c4f6f40908855951ba35c9d06cdd84c82ef3b16baf47b03d731ca2b6121f9298e5b18e47778f8b2c02aecc7bdb1a2fae511810ec582f46bc263f2173d44fca9a9aa8dc4051376cd458b438426657df3c362e8ae3a5ee5e6395d3a34027e8387b91d1517ba72b63ac4f68531f03472829b9529051290f54d575db91f8749ade1c696e67a6090d3f75f5b1c10ccafea1d895c1bb416711d1051ef360f91bca466a6ef1db10406c486db921718ba377ff13b45e6ce10a68c01254a48e48f44bfbabae10b7ce6e09803f6986e879adffa1cc4f4a0364272e8b0a4e90eb93355b4633a363366b7a31ceb69343787f9dfd91fa6729b2aae492e414967384e64a87017a870050b45811fe8beb1de7a453a9da12485da7869adcee14249d35d9d5e83846494925b8404df799069166afaa0ef1ed44d309e95dbe5c9a25480ad8b864c8c4e4a294ea03c02ec2cc5a5e6fc5e279a7841b568357bfe6605d54cdacc0303007c96736ea93498c9ecee922ff584d028ed9ef42cb55c82eac8024f8ce2a9cf90a887b336504f20943a685dc4e99fef6c0761ebddfd1569fdbfb1e2938ebebacce3d92d82d8241b06659685a72d260ee504211074ea2e83c76fa18a1c58fd7e857fbdf1e8dfbd83f931f96d6108e914193f7a065bc04874cdbcc1a2c9b1da6cb694ac0c36a9e16b2c7b06eb254522e7d35d975cab9763c9dd2a7d50108b3fa6f453c779acd2620e3501a528591585765b04df3ea84546b4dbcc47b56e0ee2cdbc830a9bb2cf80e3223f6b42303fcdee847b5b3be4e19f245fe9daffe945804497c44ebe8a5b3737e9e7d58c4cd23b36df58183086d2886cf011ce8b4f9332d98d0149cbad8212f52100385152eabb477d85b9aaf7c12f874f007c7ced9b5e8d93b61bf82268fc88d9f1bd9f82cb23ecedd20d91e25cca242c9e17ca1c3990b907b0185a8ae00b3ac49422c7cd7e5e2f48f6d46cbf978da1ee959536d3beaf4efed126959a4bab5967abbadd4573cf710432190fe5d25f35b6684c22fab39400bc83ae019234d29511a85712e0a2849a5626979e4915c42a2b66947f0a9b8c1af4cc4db4cc5e5c25fbf702ab0cebafe8476457d4b66c1532c99dc7d1e25ec01d28d4d3a5a15ab8f359d410d3dc5b0f55dcc6e7d86e32d944ff47675066a5cf41027dbd59dc3495a3323614c94d094f4216cf8c0199950476ce7a767ecb131b7276c618e7c10a361516da939751e828ef697b4b44b1aec7e30a7460dc40454b2c66834e9025217d3fefcd7c89b21c23ba26d8199c379c2eb571580de9c4dd50d4a71066d59f48638d551b03cc3887e6237d53016c66dd7e7236bc201679bdd9d681a3617a9b53378a95627808559d909b9ae8f7a80cc28ba7e80ae2ba21766a0f32308a7606cd0bbcb86b736629cc7c24d79e3d275078b39ac0d20281f65982ef8f83c4121385eadbde15e84c25d28eb33960248d72de20b5a352dc9f81e59ffb81a93918a1b603ab6e58dfcbf8ee5c94fbe00495f17c52804068ec4f2ba589cf61289b2fc871324389d1c3c1894e606ddbd48ebe85edff435f5805a17a8de3b4f3a29c0ffc67a6a4e40cee9196f0acd207bee3b768ba3c346a3695997bada530491be6f6c2e01cea2c9c24534b098c7df11505e7d644822d08247832592633b7d3f5e688d3e4639cfd4304707ff05ebb150ddcaf63a394d8f835f1ded392bc1b770df88dd30afdf58ea7d83221b635708f8222ae759f5017747711c4128957423120d1b86b0f27080bbd0c8e1fde401829304e5157178f2230a8ddfc2cbebef65dafa590484a5b842b438eff2af5758939e404e4daf8a57ddb5bb05c54f2ae496c0e9ccd42786401bb25df2ce2fb1a5e6ac97ae8742dfde1cb13e97286d1900e0c72f554097c29968c476ae84016bcecc61508010affb60a168414873cd56a36a98cc24823d4c6dec466f1d4e1eb02434bb609e879fe1362ea242766bbce178410ff61b6ad2b1a2532baa9d39e05b043768ceb274a38c744df23997d06f2eeacde61e923723b7065021f35ba3f4650dae5c7700be5369a6bf15db3d9369b79a416ae14aa4b1fcb8e55e0e6d9c15d2ff459ad6a774e78b2f3d73edd2171978f4078936eddc166ed9aca172c2a630702010fac47dd48e2d359622b7146de2fea8db2f56a0f6095d3fb77d21e07125856cbf63e997d3246fe8cfbd770afc1a364da49363cf696f1239e5ce22fb8fa8023a278ed250484655040162bb45eb06d9fd31b4bea11ad8885d9f3e5b0d1c0865bc02abce5fb79669203e1ae90a607343cc7771b23fc45248cd9bb948abccc404cecd6a61304734942e6f4dfff28f7138ae2448023b667404b5eb231d3b426de466922262d308d2ad2929dc4f035461a6946c4b00a8838a3582e31dbec9e1368aded3fde5dd9906963cacbec4146ff6764000cc6a631891586db20ff32d4a512eebbdc669ba66862f84c83f815c4b5f72096b94fd2e2c553ccdcebef28c2ebc491dea7c88e640516afa1a6fe99eb492b7c70b2fc654635a5c285501dbcaf05bdbc668d7101035977f3166e198d9bd80ac4b4512e03c3f68ecdc3db3de6173b8c5495f0c2ae79ddaf28c0b7637d1876f18c92c3938a74d33a6576c6063126bab24ef0e5af16a9ef3ead0d43e0c7f40ee66ffc6809af2f574353987198179e8bf72d48283c9218bdf8f48fb1ae35427c5572a503459ab395377e7f2c4b7c3764930bbf8cf2ec7979f0b8dd3f4c040deb4fd4dc162222e95ead07603c98d0ca943132068a94882aecbea832ebb44c813bb1aa3842967aa4383460804c42d298f0964e102a3cc22f9dcf4f34339c5940e1c8e9e73d880a93a77315367fd4b76547dbe74763b48f6b09d7940b2d7c19f6909de8e042999e8f41d5f2544dc00c05db749b70643a2879df3a56caf919a54f0cc1a4f18984b1456e18022bea1f2bfb78e52a23647070ed434ffe494c250e07ad7a6beb03becc625126680101e802b70068d4b2d6ca9df7d8b34ed7ba2ab5841e17f7543dc9334d1f0c05d7b94c965bf9899ae09117d11cd3494083d1de83654fe5484ba88948925fe990cdb7bfa5cafbbd215171108bc216ff803cf7498565e5bd9ad22ca26f51c942b239ad0e44b6dfb94979f6c7e9f0280f272ca3ebb96707b4136cc29d442496820a5e01a0aa7bc1f53c7525f8cba3beb2cbbbb1f735b0da20bab75e37bb59ef7051f19bf97a197d7abfde3d0638fe3689278071900274ff6c75668eee38099a7b9c29c45ad76228d58b5f65f60a5addd32a9da54c860373c3e80c220a6f35b48e9b22c28b51a5601858ff4d9397b4efef76a18f73af04f21cf5f5bbb0270273efc43d2a75b889d3c16c23159e1a1d8bb63ae896ece056f24efe6648f3effe8bf326856028ad271cfc8b202d54b6f0087daa576e4f23f1e051ea0400aad53e125744abfeb8bd39d3406a204cee6a1b71cd31f9f655e959752ffc356ab2c01cda672ec88f33b7d94584b029251f9099d485341dbc2c0c60f8619be7b5ad1197a86e15bbb527b1a1f2d27a4e04c96aaf5d60cba203962a57ed349cb0ae34b075e335ac9449ab0c2e70ab4f3f6ec9d0aaa3f1cd7bfd8c8e5490f0b399c1b9def74ce8c04e37f1e047cf5ca818f7a69314f07d287874f824c38b7d9ec10e31746df60cd303abb4cb78e3abfaa666e973b993b8ecb911fd71d0195245635b15381f8075eadf0cf6bd67dd7196303da7acd75a4c48dfc90bab69778dd232e2f9d22ed00eea7fd54f3c253df0bc10d2d657651e48cd33b612a060534337bb470e71ab9840d6dc7ddff725d9f45faa9049521147a9629729cd8817ecd15cd6b6fea55aaafbcf4152d6c1b117b4c6074830710f0e577fbc09a8bfe737d47560f3571e7f9113ddb99d8de352ef0fdcbf5e918713c75c076c4d5a3b8fef0fe7fe2061371946c7b469f563f89bc7176a275f8fe1a9672e12e80e00b12ad38316c1665c6a0c7e3ae5b50c151c1bde6e67e74517aed7f03ee6a51db3f149e5c84a93a6f173b9563564c119c8732fb2d58f478eae8bfa4c44b0c6925a8d4a8783aa5e77bca304d582e38582db72ac78921910546240aec1e297b3d5f834efbc701e72143dd723c9bebdcc5550ee1f1aec0c64efd4f2bdeaf29e744b178ed027ddc0fa73a03f231a39b6c57d1edc66ff6044dd7690d1f6ee6bdd66bfbd21f1db90ea1550c1bc90039d4edbf9a018d4d44d94445bb0188407b1d344e938949a52f9ed263d5678418c819eb37b41e25441ccaa2151182076482a6b5fabbd85bd65509801057bcc28939da2389a1510dfdcb3f1e0906cace754f2c395e21a821603b1aeea7cf9974e879a983efc8d4883110b9ac7c7ec03226f3e0a6c23320984b01e51186fcf65b79fb943232ba00bf6bc977d9b7f15f869fd0f5fa6193b2c2f9a6c89992468ba28273f8a3d28b651a9c84b5c3259b5dcd7720199da69730d5a336a4a413f222154bcefded1512dbb4657a94fc7662400f3cbe5e362d4b369572cc8acd6965efb175cb73c3754533a3f5b955d930c779a4c739523a684de84d1620c05c3748232a368e07cc867ad24e6327109aa28adc7a5514c568eb597e56909d9336346d95147a317e8f183ff30e72ad1b96c4263032046984c698e1b308d7747a328b5a1a455d4d7cc15f22f3967933b7197e31942a59b8c070c2855d3a058d478ce14d791cae60f7eb7a4ea24a0c904c92d22635105464d625dfacb0528d41f1a12e6d162aa6df75352665890fafec9bd2c4b84fb05543776a308f95f1746bce72461c78d2e7978c3e1cf58cece8c5526d455fe77a0af5f02964062ea795244feeff3c15f61d00177c563bf0b7d34bd6bebca722e64391ee8ad06765c504e760143f8878d402aeb75e20f7a44ac03a20fc4ac9741ab0ab4c4c8ac7e4d4e4c0a5a6478bd8c35acecfdd363d83b95e8f1dfdfbada089507fd97022d4aa58aefe8ac726cb4265cfc6fd1ed4459d9bd6c35e3c7d5c425791df4a2aefa607af31a5e24a253fc390267fcddc98b1d3a260bfdf8fa62a14ff0a3bfd2bddaba00a9571628865adf641479117962468fa16201ddb995a78eb4eb177931a3d079c3164faf3cbe44787b140c56a0bcefe30d54c9575d7e1aa5cfd551665829bb1eed72ecf3065c192587e98bda7351cd1dd9a6d0709f5e19d737420922fb2600851dc9ce8c594975fe0a600062833b024ae823013f25a66f9faeaa895a7de80adddb951ba90f306228062a9ec89ced58d139e2d8a5d71010c69968fa9186f3dc9f53b8f8d2c2edf77470fe286f01e5277799f9e3c150c909bd0a245a577190f0a4a438dcc00087fe0799ed60e331536db32ed99c8c4614b11ea4aeff774ac4d1f2841adc305e9ce941dae4a360f57cc7836e86ab0cbf35e1b8e12fb4beb839e1ca4dadc7f7ac5faf2b615464cc94ea1fafce6edf1098f77e9c49f9aee67293ac4195700984007f33dbe7fd219dcb94eb1c9ebd5249cb103b34acbde119da47f4bd595f495297d3ec154058b467467e344bb5adec67768c1e9026a5d4cc5314a42025254bd66e22e4fc3271c359d96d1cea530f08f8281447f2ca8590b1be21ad5955ed6c748145c9e4171d00408cdf7f4a8ae8be56aeb51e2be1e6dea22fa8a151ec70e9bc1fae6b25384d6bef2bece41d01db7b83a6111d59ce17fe119668e8cac9121a08994514be161db082560dae554a856e6d8b0a58c849a33d356f966761f7142dd5df2ce4bb9762abb8ba3d021d7d4c7c1b11eb6b2cfb3d5f97235043eacca564eea7e4389f07753290bfb3b3e512280e21eef1fede274b5699c51358add9b868d935b817c126f518d9a1053e7ca00b06598554e4ef60bbfff3a78710daf4e442dbb799754b0d5ef99eab370796322f6592ecb176d6ea23dcf06729c8aa382d113eff91878069924f32e45efac58bbfe55dc1d43a8a6413fc0ae7668b7097af6f5c889f1085530e2b96bd7e8285c706b68387af49fd5759f6907b715ef38221623787e2c023daaf69882e87866521239ca5227841689321e1c23766cddb0ba602f9242c3f578e157518ca528f8ce30da17b700d5fa9739a315dad9094ad0b4b6beb00927cad16126d68a6d8a8bb8e2fa687bcaa408a1dfce514289366d806ebcf5638690982c0dcfd39ec6decce9f8db155e1f82fcf26944ab9c42948d279f9cc5c5f47f5be4ea2d8e0d2ea546faf53d59c7c56bf89c78787fef5c06d578c82d77a1207f00c14d6e31209e57f4d363ffcda152cb76c447dcc18aeabdda273b963304ff854d50cb16b5ba1b6522140d9d1c00a4fad06bd55afe1ac3a42b9cf20d57a3fcd162dd3b3d7908c89c6df1889d272a7bb348b7207d6da981624a86efc5b204ab44924e51d3e50ee503b4f2b3f189bf741cbcfd78e3e6c42e9ad02fc953ac70c97cc85c33d1331b2f43be407d4b6310c76defbb762702690c7bbd3d7f12a616ba2be150d42d1f449374791709876542457b24f10f905b290a372c827544a8c027774fcb95bcc5b00d395d11dd00be2356019c3d97e62cf4fed5bc2d3ab924b34ad9f38a9b02eeacc78182b18686b55906792d3bf388fd6915a2d76a1f4ddb1859fb3ab85028e47b1929d46ce0f911cd8950e9cdbe77e189610f649b82c27f0c1d2e152d2011b04e79ac2d447c00a398e4d7c6fe202af2e92fe2f87b2ac4ce8c4aaaa8a0e73bc7fff3c354f90395b429d2aa46e82d1eb0f0750bb4394699b68948ac252929916296c08e31965a1ed29ebbd035f57fd62dc8b3648534ea7c281d7efe079e436862954d0afbe07f457cefdb0e66bf570115ffa4da4b54cfd7c74538a6e67c62a3283bdfc5d9703d69abab5da1c3cb9d4c47d26d223291df7ae2a5d22e0405f6b83a89343667d1373569f58e3c818ebb1c6b0b9018c33602b3d9838fc06cc63cdef00c232e9bbbc275660e2939bedbb6c19b32efb7f8eabadcb95994c935f8b2b61a864be1ecc5f818f3be22b5fcacebb0819951b6d5baf5e74e95df76976a03335d984471647e0a5438db2c8ef4d8b2ddd57e5c315b8279daff8fb86ac026187064a4f3e32a64dbc45266b213be19112b03709f790a1f4d18c2655d698112431d234f879b020db34803ecb2cb892b7cf988388eb6dd6fd33467854cf19cd26b1629af18dcad744aebfdd9e22dbd5651c30809e28e8bde647d0dff402177c018f8bc3d05c7dffe60f8f2391d3ee49bd6fcfc3245af7a68d569eecf2fe7cc3b08b738cc65e4a82d7880e2c9de674e9fcfa5ea02da8c86e436c62be10126896f3f74574bac4de7fd06c2aac0c1c0489ba9fd84263c7e80b0e10fb28ff7480d0340a42aeadb3b9a574d6669f0e5c8f1bbdbe67b6736c463a5177e6c2dd8977523c52d7c87f2975c7bc25e6ee77cbf2bdbf38f6791b4790796e87f38b8cce46104f87723bd8690876eba936fe3a10e88c40fc5b1ef1832f6a28d6798f07219c4ca4404ea640cb62cb551476fc3d1401060b4e47d6803fc119862f1ecb1b693fb36133cf5de408a49d5260210b05f24cf48cc349cc5a6e19db9b175ea1ecd85395b0b3932ad6859710596642def93d623e1c2b2bd597c4eef5bddc1adfb3b3abf81667b61901dbf1b3cc3f625b7521a1dee4cdba3909e4c50868f6bee60c98a909a2c283a4575370a23411a7b028bdeb1fc4c873cb696c81f7e818b62e86dd8dd435ce1a674d4c9d3e01226c9bb846fad51520a62d1608aefdfd683e4a95de83ca002a044bd14a7a7f49151671ea64f2d3ead948df0f3b5e3e8bfb38acd76a0640185ec2a58974e9cb7c9b24452d53a9ea2c1a2efa021c38950c485f2c3b52f47ae1124ecd650ebff0e4a755314a78bfb6df528e74844d9c74db486ec6593509fec36c5fc7478efacf677ff573f3891755845905e87c653cedf4a4723a0c9a81960798aa8663083de6776b845261880a8e298bc0a195b7ec58d7a76d4ee51d299a595fb54a21ab645285f3f52b7390f7a2d17d513f485b5c81af74af97bb1c4586ed0c1d0af4e40021bbae4023217146a4a8dbe6f579f6750c94b006483547965f5042b001b35d6d7759166cb21091b6ce0eb49608edd5da0b6aa018046c8369ba7d5d848be519571e01524c39dbb56490e2f77b7ba9510cfaaffc5870b1a6aaa93c2ec18219204c90d454cea65ff9d4cdaaf519a78fac1529799aff2c918a5efc011364ea9fa9b0cf8bbe8a5b32ead6cd02094b72d3b58ad425b254811e13ada1ad9d3ffafd2cceaeb84b525cad613ea9882a89fbdfc24aa659ac67198aaf0d6af4cc946adc748744af67ffc791d6ad48940f61f3b9b6a54b4e6dabea89e668c6db74f432311a75809dca472e6d976f1b7da1d0850b8cb5b166127e80d38ffd82099c2b3174229de7f7f6742a3a268a28c6974d0fec6bd0909898bb0572fbab6934b9266188cd465c489ee0b7cf6a42e3411bf4505979538089363d688aad991459042268bc5ee4769c931a40c93eea4dff5af2d5ae03f802c233be42760752943263576ebb38d86bede299a34c78b9e387b42c59f4837008678f3d4f466e230066db6","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
